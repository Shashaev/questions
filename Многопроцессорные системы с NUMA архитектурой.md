NUMA (Non-Uniform Memory Access) – это архитектура многопроцессорных систем, в которой время доступа к памяти зависит от ее физического расположения относительно процессора. В отличие от SMP (Symmetric Multiprocessing), где все процессоры имеют равный доступ к памяти, в NUMA каждый узел (процессор + локальная память) работает быстрее с "своей" памятью, чем с памятью других узлов.  

________________________________________  

1. Основные принципы NUMA  

1.1. Структура системы  

• Узлы (NUMA nodes) – каждый содержит:  

o 1+ процессоров (CPU),  

o Локальную оперативную память (RAM),  

o Связь с другими узлами через высокоскоростную шину (например, AMD Infinity Fabric, Intel QPI).  

• Память распределена, но логически едина (все CPU видят общее адресное пространство).  

1.2. Примеры реализаций  

Платформа Технология Примеры процессоров  

AMD EPYC Infinity Fabric EPYC 7763 (64 ядра)  

Intel Xeon QPI/UPI Xeon Platinum 8380  

IBM POWER NVLink POWER9  

________________________________________  

2. Достоинства NUMA  

Масштабируемость  

• В SMP рост числа CPU приводит к "пробкам" на шине памяти, а в NUMA каждый узел имеет свою локальную память, что позволяет наращивать систему до сотен ядер.  

Высокая производительность для "локальных" задач  

• Если процессор работает с данными в своей памяти, задержки минимальны (как в однопроцессорной системе).  

 Эффективное использование кэша  

• Кэш-когерентность между узлами (протоколы MESI, MOESI) уменьшает накладные расходы.  

Поддержка в современных ОС  

• Linux (numactl), Windows и VMware автоматически оптимизируют распределение процессов.  

________________________________________  

3. Недостатки NUMA  

 Неравномерность доступа к памяти (проблема "Remote Access")  

• Доступ к "чужой" памяти в 2-4 раза медленнее, чем к локальной.  

• Пример: если поток на CPU 0 работает с данными из памяти CPU 1 – будут задержки.  

Сложность программирования  

• Нужно явно учитывать расположение данных (numactl, #pragma omp в OpenMP).  

• Неоптимальный код может работать медленнее, чем на SMP.  

 Проблемы с балансировкой нагрузки  

• Если ОС неправильно распределяет потоки между узлами, возникает NUMA imbalance.  

Ограниченная совместимость  

• Не все приложения оптимизированы под NUMA (например, старые игры или ПО без поддержки многопоточности).  

________________________________________  

4. Сравнение NUMA с SMP и MPP  

Критерий NUMA SMP MPP  

Масштабируемость До 100+ ядер До 8-16 CPU 1000+ узлов  

Задержки памяти Зависят от расположения Одинаковые для всех Только локальная память  

Сложность Средняя (нужна оптимизация) Низкая Очень высокая  

Использование Серверы, СУБД, виртуализация Десктопы, легкие серверы Суперкомпьютеры, Big Data  

________________________________________  

5. Оптимизация под NUMA  

5.1. Аппаратные методы  

• Выбор процессоров с улучшенными межсоединениями (AMD EPYC > Intel Xeon в NUMA-сценариях).  

• Использование HBM (High Bandwidth Memory) – как в AMD MI300.  

6. Примеры использования NUMA  

• Серверы баз данных (Oracle, Microsoft SQL Server).  

• Виртуализация (VMware ESXi с NUMA-aware планированием).  

• Научные расчеты (CFD, молекулярное моделирование).  

• Игровые ПК высокого класса (AMD Ryzen Threadripper).19:42