### ***Кратко(Дипсик)***

### SMP-системы (Symmetric Multiprocessing)  
SMP (симметричная многопроцессорная система) — это архитектура, в которой несколько процессоров (ядер) работают совместно, используя общую память и ОС, управляющую нагрузкой между ними.  

---

## 1. Классификация SMP-систем  
### 1.1. Сильно связанные системы (Tightly Coupled Systems)  
- **Определение:** Все процессоры имеют доступ к общей памяти через единую шину или коммутатор.  
- **Структура:**  
  - Общая физическая память.  
  - Единая операционная система, управляющая всеми процессорами.  
  - Высокая скорость взаимодействия между процессорами.  
- **Примеры:** Многоядерные CPU, традиционные SMP-серверы.  

### 1.2. Слабо связанные системы (Loosely Coupled Systems)  
- **Определение:** Каждый процессор имеет свою локальную память, а обмен данными происходит через сеть или специализированные интерконнекты.  
- **Структура:**  
  - Распределенная память (каждый CPU имеет свой RAM).  
  - Обмен сообщениями (MPI, RPC).  
  - Менее эффективное взаимодействие, чем в сильно связанных системах.  
- **Примеры:** Кластеры, grid-системы.  

---

## 2. Основные структуры SMP-систем  
1. **Общая шина (Bus-based SMP)**  
   - Все процессоры и память подключены к одной шине.  
   - Простота реализации, но ограниченная масштабируемость.  
2. **Матричный коммутатор (Crossbar Switch)**  
   - Позволяет нескольким процессорам одновременно обращаться к памяти.  
   - Высокая производительность, но сложная и дорогая реализация.  
3. **Иерархическая структура (NUMA — Non-Uniform Memory Access)**  
   - Память распределена между узлами, доступ к "чужой" памяти медленнее.  
   - Хорошая масштабируемость, но требует специальной поддержки ОС.  

---

## 3. Достоинства и недостатки SMP  
### 3.1. Достоинства:  
✔ **Простота программирования** (общая память, многопоточность).  
✔ **Балансировка нагрузки** (ОС распределяет задачи между CPU).  
✔ **Масштабируемость** (можно добавлять процессоры).  

### 3.2. Недостатки:  
❌ **Ограничение пропускной способности шины** (конфликты доступа).  
❌ **Сложность масштабирования** (при большом числе CPU шина становится узким местом).  
❌ **Проблемы когерентности кэшей** (необходимы механизмы типа MESI).  

---

## **4. Методы организации доступа к общей шине**  
### 4.1. Арбитраж шины (Bus Arbitration)  
- Определяет, какой процессор получит доступ к шине.  
- **Методы:**  
  - **Централизованный арбитраж** (один арбитр решает, кто получит доступ).  
  - **Децентрализованный арбитраж** (каждый CPU сам участвует в "конкурсе").  

### 4.2. Протоколы когерентности кэшей  
- **MESI (Modified, Exclusive, Shared, Invalid)** – предотвращает конфликты при записи.  
- **MOESI** – расширенная версия MESI (добавлено состояние "Owned").  

### 4.3. Методы доступа к шине
1. **Статический (фиксированный) доступ**  
   - Каждому CPU выделяется фиксированный временной слот.  
   - **Плюсы:** Простота.  
   - **Минусы:** Неэффективность, если CPU не использует слот.  

2. **Динамический доступ**  
   - **С приоритетами** (более важные CPU получают доступ быстрее).  
   - **Round-Robin** (циклическое переключение между CPU).  
   - **Случайный доступ** (используется в некоторых сетевых протоколах).  

3. **Пакетная передача (Burst Mode)**  
   - CPU, получивший доступ, может передавать несколько слов подряд.  
   - Уменьшает накладные расходы на арбитраж.  

---

## **Вывод**  
SMP-системы обеспечивают высокую производительность за счет параллелизма, но их масштабируемость ограничена пропускной способностью шины. Для уменьшения конфликтов используются арбитраж, кэш-когерентность и эффективные методы доступа к шине. В современных системах часто применяются гибридные подходы (NUMA, комбинирование SMP и кластеров).

### 

Симметричные мультипроцессорные системы - (SMP, Symmetric Multiprocessor).

В симметричной системе все ресурсы системы (ОЗУ, ВУ) общие и все процессоры имеют одинаковые прав на их использование. В самом общем виде SMP система имеет вид представлены на рисунке.

![[Pasted image 20250616131002.png]]

Важным аспектом архитектуры симметричных мультипроцессоров является способ взаимодействия процессоров с общими ресурсами (памятью и системой ввода/вывода). С этих позиций можно выделить следующие виды архитектуры SMP-систем:

1. с общей шиной и временным разделением;
2. с коммутатором типа «кроссбар»;
3. с многопортовой памятью;
4. с централизованным устройством управления.

Архитектура с общей шиной

Структура и интерфейсы общей шины в основном такие же, как и в однопроцессорной ВС, где шина служит для внутренних соединений (рис. 14).

![[Pasted image 20250616135621.png]]

Общая шина позволяет легко расширять систему путем подключения к себе большего числа процессоров. Кроме того, шина – это по существу, пассивная среда, и отказ одного из подключенных к ней устройств не влечет отказа всей совокупности.

В то же время SMP-системам па базе общей шины свойственен и основной недостаток шинной организации – невысокая производительность: скорость системы ограничена временем цикла шины. По этой причине каждый процессор снабжен кэш-памятью, что существенно уменьшает число обращений к шине. Наличие множества кэшей порождает проблему их когерентности, и это одна из основных причин, по которой системы на базе общей шины обычно содержат не слишком много процессоров.

SMP-системам па базе общей шины свойственен и основной недостаток шинной организации – невысокая производительность: скорость системы ограничена временем цикла шины. По этой причине каждый процессор снабжен кэш-памятью, что существенно уменьшает число обращений к шине. Наличие множества кэшей порождает проблему их когерентности, и это одна из основных причин, по которой системы на базе общей шины обычно содержат не слишком много процессоров.

При построении систем с обшей шиной возникает проблема управления доступом процессоров к общей шине. По терминологии Intel имеется два подхода: сильно связанные и слабо связанные системы.

  
**В сильно связанных системах** процессоры объединяются в группу, они разделяют все линии интерфейса, и с точки зрения внешнего наблюдателя выглядят, как один процессор. Один из них назначается ведущим, а все остальные ведомыми. Ведущий всегда владеет системной шиной, а остальные просят у него разрешение на доступ и получают его в соответствии с назначенными приоритетами. Примером может служить организация многопроцессорной группы с процессором 8086,

где 86 – ЦП, 87 – сопроцессор, 89 – процессор ввода/вывода

![[Pasted image 20250616135804.png]]

Особенностью такого решения является то, что не все процессоры могу объединяться в такие группы. Дело в том, процессоры по своей природе могут быть только ведущими, только ведомыми, и универсальными (и ведущими,  и ведомыми в зависимости от включения). Отсюда выходит, что процессоры спроектированные как ведущие в такие группы объединятся не могут. Все процессоры Intel до Pentium 2 спроектированы как ведущие, остальные могли быть как ведущим, так и ведомым, т.е. можно на их основе построить сильно связанную систему:  Pentium 3 позволял строить систему из 2 процессоров, Pentium 4 из 4 процессоров.

Если все процессоры ведущие, то проблему управления доступом придется решать внешними схемами так называемым арбитром (слабо связанная конфигурация)

В слабоявязанных конфигурациях любой процессорный модуль м.б. ведущим и может содержать в себе сколько угодно ЦП. В слабоявязанных конфигурациях прямые связи между ЦП отсутствуют, и взаимодействие осуществляется через внешнего арбитра.
в такой системе процессоры подключаются к системной шине чрез схему доступа, которая держит выходы процессора в отключенном от шины состоянии и разрешает подключение при получении сигнала от арбитра. Если процессору нужен доступ к  шине он выставляет сигнал «запрос» арбитру и арбитр, если не занято выставляет сигнал «разрешение», получив разрешение процессорный модуль выставляет сигнал «занято» и владеет шиной (Время владения шиной ограничено)

![[Pasted image 20250616140156.png]]

  
## Методы организации доступа к Общей шине в многопроцессорных системах.

Логика управления доступом к общей шине должна обеспечивать режим, в котором в любой момент времени линией управляет только один ведущий. Одновременные запросы к шине  разрешаются на основе приоритетов.

Можно выделить несколько способов (приемов) приоритетного выбора:

1) Приоритетная цепочка (относится к последовательным схемам арбитража)
2) Опрос (относится к последовательным схемам арбитража)
3) Независимое опрашивание (относится к параллельным схемам арбитража)

Приоритетная цепочка – самый простой способ.

![[Pasted image 20250616182937.png]]

Каждое устройство имеет 4 линии:

1)     вход разрешения
2)     выход разрешения
3)     линия запрос
4)     линия занято


Когда какой-либо процессор хочет получить доступ к СШ, он выставляет сигнал – запрос доступа. В исходном состоянии все процессоры от СШ отключены. Арбитр шины выдает сигнал разрешения, если сигнал запрос активен, а сигнал занято  пасивен.

Является самой простой, требует минимум затрат, основной недостаток: в такой системе надо следить за сохранностью линий разрешения, самая медленная схема; Приоритет в такой структуре определяется местом установки в цепочку местом установки в разрешение.

Есть другой способ который можно свести к способу опроса. При реализации способа опроса может быть введена линя адресации (шина адреса) модулей.

![[Pasted image 20250616183110.png]]

Структура будет следующая:

В такой структуре в ответ на запрос при снятии сигнала занято арбитр генерирует последовательность адресов; когда модуль узнает свой адрес он выставляет сигнал занято. Такая схема свободна от недостатков предыдущей схема.

Приоритеты определяются не соединением модулей между собой, а порядком опроса – это плюс.

Минус: арбитр сложнее; время арбитража больше.

Метод независимых запросов.

![[Pasted image 20250616183154.png]]

При этом методе каждый модуль имеет отдельную пару линий запроса и разрешения.

Арбитр должен представлять некоторую схему приоритетного выбора (выбирать должен запрос в соответствии с приоритетом).
  
Например на основе приоритетного шифратора. Приоритетная шифрация породит 3-х разрядный код; дешифрация породит 8 линий разрешения

![[Pasted image 20250616183226.png]]

Время срабатывания в этой схеме – это время срабатывания буферов выходного разрешения. (время от момента снятия сигнала занято до момента захвата шины -  самое маленькое).

Такая схема самая быстрая; но, достаточно плохо расширяется (сделаешь арбитр на 8 устройств, то 9 устройств еже не прицепишь); достаточно сложный арбитр.

Структура процессорного модуля для многопроцессорных систем на базе общей шины.

![[Pasted image 20250616183613.png]]

По минимум должно быть :

·       В минимальной конфигурации процессорный модуль для многопроцессорных систем с общей шиной должен содержать процессор, схему доступа к системной шине.
·        
Схема доступа к системной шине состоит из части схемы, которая взаимодействует с арбитром.

Когда ЦП вырабатывает любой цикл обращения к системной шине со схемы шинного интерфейса выделяется «запрос», он идет на арбитр. Сигналом «разрешение» шинный интерфейс открывается. Захват идет на один цикл, по его истечении выключается схема шинного интерфейса.

Самый главный недостаток – такая многопроцессорная система с точки зрения производительности не обладает возможностью параллельной работы (так как нет внутренней памяти) и даст незначительный выигрыш, за счет уменьшения времени переключения с задачи на задачу.


**Архитектура с многопортовой памятью**

Многопортовая организация запоминающего устройства обеспечивает любому процессору и модулю ввода/вывода прямой и непосредственный доступ к банкам основной памяти. Такой подход сложнее, чем при использовании шипы, поскольку требует придания ЗУ основной памяти дополнительной, достаточно сложной логики. Тем не менее, это позволяет поднять производительность, так как каждый процессор имеет выделенный тракт к каждому модулю ОП. Другое преимущество многопортовой организации – возможность назначить отдельные модули памяти в качестве локальной памяти отдельного процессора. Эта особенность позволяет улучшить защиту данных от несанкционированного доступа со стороны других процессоров. Однако много портов в памяти невозможно создать технически.

![[Pasted image 20250616134215.png]]

  
**Структура на базе коммутатора «кроссбар» (crossbar switch)**

![[Pasted image 20250616134301.png]]

Архитектура с коммутатором ориентирована на модульное построение общей памяти и призвана разрешить проблему ограниченной пропускной способности систем с общей шиной.

Коммутатор обеспечивает множественность путей между процессорами и банками памяти, причем топология связей может быть как двумерной, так и трехмерной. По логике коммутации строится и взаимодействие процессоров с устройствами ввода/вывода.

Результатом становится более высокая полоса пропускания, что позволяет строить SMP-системы, содержащие больше процессоров, чем в случае общей шины. Число процессоров в SMP-системах на базе матричного коммутатора может составлять несколько десятков. Наибольший выигрыш в производительности в системах с коммутатором достигается, лишь когда разные процессоры обращаются к разным банкам памяти.


### Основными недостатками SMP являются:

#### Ограничение на количество процессоров

При увеличении числа процессоров заметно увеличивается требование к полосе пропускания шины памяти или коммутатора Это налагает ограничение на количество процессоров в SMP архитектуре..

##### Проблема когерентности кэш-памяти

В каждом процессоре имеется своя кэш память, а значит причин нарушения когерентности кэш  становится больше и проблема обеспечения когерентности становится сложнее. Решить эту проблему можно по разному, самый простой способ отслеживать записи в память и корректировать локальные кэш. Разрешение этой проблемы возложено на _протокол согласования кэшей_ (cache coherence protocol), который призван обеспечить согласованность («когерентность») кэшей всех процессоров и основной памяти без потери общей производительности.

В современных системах процессоры многоядерные и фактически процессорный узел является SMP системой.